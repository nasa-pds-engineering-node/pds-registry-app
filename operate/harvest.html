<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/xdoc/operate/harvest.xml.vm at 2021-04-28
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>Registry Application &#x2013; Harvest Operation</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="https://pds.nasa.gov" id="bannerLeft"><img src="../images/pds_banner.png"  alt="" width="500"/></a></div>
          <div class="pull-right"><a href="https://github.com/NASA-PDS/pds-registry-app" id="bannerRight"><h2>PDS Registry</h2>
</a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2021-04-28<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.3.0</li>
      <li class="pull-right"><a href="https://github.com/NASA-PDS/pds-registry-app" class="externalLink" title="Registry App Github Repo">Registry App Github Repo</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Software Documentation</li>
    <li><a href="../index.html" title="About PDS Registry Application"><span class="none"></span>About PDS Registry Application</a></li>
    <li><a href="../install/index.html" title="Installation"><span class="icon-chevron-down"></span>Installation</a>
     <ul class="nav nav-list">
      <li><a href="../install/java.html" title="Java"><span class="none"></span>Java</a></li>
      <li><a href="../install/es-dev.html" title="Elasticsearch - Quick Start"><span class="none"></span>Elasticsearch - Quick Start</a></li>
      <li><a href="../install/tools.html" title="Tools (Manager, Harvest)"><span class="none"></span>Tools (Manager, Harvest)</a></li>
      <li><a href="../install/api-server.html" title="API Server"><span class="none"></span>API Server</a></li>
      <li><a href="../install/test.html" title="Test your deployment"><span class="none"></span>Test your deployment</a></li>
     </ul></li>
    <li><a href="../operate/index.html" title="Operation"><span class="icon-chevron-down"></span>Operation</a>
     <ul class="nav nav-list">
      <li><a href="../operate/common-ops.html" title="Common Operations"><span class="none"></span>Common Operations</a></li>
      <li><a href="../operate/test-vs-prod.html" title="Test vs Prod"><span class="none"></span>Test vs Prod</a></li>
      <li class="active"><a href="#"><span class="none"></span>Harvest</a></li>
      <li><a href="../operate/reg-manager.html" title="Registry Manager"><span class="none"></span>Registry Manager</a></li>
      <li><a href="../operate/reg-custom.html" title="Registry Customization"><span class="none"></span>Registry Customization</a></li>
     </ul></li>
    <li><a href="../prod/index.html" title="Production Deployment"><span class="icon-chevron-down"></span>Production Deployment</a>
     <ul class="nav nav-list">
      <li><a href="../prod/es-vm.html" title="Elasticsearch (VM)"><span class="none"></span>Elasticsearch (VM)</a></li>
     </ul></li>
    <li><a href="../security/index.html" title="Security"><span class="icon-chevron-down"></span>Security</a>
     <ul class="nav nav-list">
      <li><a href="../security/proxy.html" title="Load Balancer & Proxy"><span class="none"></span>Load Balancer & Proxy</a></li>
      <li><a href="../security/es.html" title="Elasticsearch"><span class="none"></span>Elasticsearch</a></li>
      <li><a href="../security/reg-mgr.html" title="Registry Manager"><span class="none"></span>Registry Manager</a></li>
     </ul></li>
    <li><a href="../index.html#Support" title="Support"><span class="none"></span>Support</a></li>
   <li class="nav-header">Downloads</li>
    <li><a href="https://github.com/NASA-PDS/pds-registry-app/releases/download/v0.3.0/pds-registry-app-0.3.0-bin.tar.gz" class="externalLink" title="Current Release (tar.gz)"><span class="none"></span>Current Release (tar.gz)</a></li>
    <li><a href="https://github.com/NASA-PDS/pds-registry-app/releases/download/v0.3.0/pds-registry-app-0.3.0-bin.zip" class="externalLink" title="Current Release (zip)"><span class="none"></span>Current Release (zip)</a></li>
    <li><a href="https://pds-engineering.jpl.nasa.gov/content/pds4-software" class="externalLink" title="Past Releases"><span class="none"></span>Past Releases</a></li>
   <li class="nav-header">Change Log</li>
    <li><a href="https://github.com/NASA-PDS/pds-registry-app/blob/master/CHANGELOG.md" class="externalLink" title="on github"><span class="none"></span>on github</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >



<section>
<h2><a name="Harvest"></a>Harvest</h2>


<p>
</p>
<ul>
  
<li><a href="#Overview">Overview</a></li>
  
<li><a href="#Quick_Start">Quick Start</a></li>
  
<li><a href="#PackageID">Package ID</a></li>
  
<li><a href="#NodeName">Node Name</a></li>
  
<li><a href="#Registry">Registry Integration</a></li>
  
<li><a href="#InputDirs">Input Directories and Filters</a></li>
  
<ul>
    
<li><a href="#Dirs">Crawl Directories</a></li>
    
<li><a href="#Bundles">Crawl Bundles</a></li>
    
<li><a href="#BundleVersions">Filtering Bundle Versions</a></li>
    
<li><a href="#Collections">Filtering Bundle's Collections</a></li>
    
<li><a href="#ProdDirs">Filtering Bundle's Product Directories</a></li>
    
<li><a href="#ProdClass">Filtering Products by Class</a></li>
  </ul>
  
<li><a href="#Extract">Extract More Metadata</a></li>
  
<ul>
    
<li><a href="#FileInfo">Basic File Information</a></li>
    
<li><a href="#BLOB">BLOB Storage</a></li>
    
<li><a href="#FileRef">File Reference / Access URL</a></li>
    
<li><a href="#XPath">Extract Metadata by XPath</a></li>
    
<li><a href="#DDic">Extract Metadata by Data Dictionary Class</a></li>
  </ul>
    
<li><a href="#IntRefs">Internal References</a></li>
</ul>


<section>
<h3><a name="Overview"></a>Overview</h3>


<p>
Harvest is a command-line tool for extracting metadata from PDS4 products (labels).
It parses PDS4 files and stores extracted metadata in a &quot;newline delimited JSON&quot; or XML file.
The JSON file can be loaded into Elasticsearch by Registry Manager.
The XML file can be loaded into Apache Solr by Solr &quot;post&quot; tool or from Solr admin UI.
</p>

<p>
Harvest executable scripts for Windows (<i>harvest.bat</i>) and Linux / Mac (<i>harvest</i>) 
are located in <i>bin</i> sub-folder of the installation directory (e.g., <i>/home/pds/harvest/</i>).
</p>

<p>
To see the basic usage information (shown below) run Harvest without any parameters.
</p>

<div class="source"><pre class="prettyprint">
Usage: harvest &lt;options&gt;

Required parameters:
  -c &lt;file&gt;     Harvest configuration file
Optional parameters:
  -f &lt;format&gt;   Output format ('json' or 'xml'). Default is 'json'
  -o &lt;dir&gt;      Output directory. Default is /tmp/harvest/out
  -l &lt;file&gt;     Log file. Default is /tmp/harvest/harvest.log
  -v &lt;level&gt;    Logger verbosity: 0=Debug, 1=Info (default), 2=Warning, 3=Error
</pre></div>

</section>
</section>



<section>
<h2><a name="Quick_Start"></a>Quick Start</h2>

<p>
To run Harvest you need an XML configuration file. 
The configuration file has several sections which control which files the Harvest tool 
will crawl and what data to extract. Very basic configuration is shown below.
</p>
<div class="source"><pre class="prettyprint">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;harvest nodeName=&quot;PDS_SBN&quot;&gt;
  &lt;directories&gt;
    &lt;path&gt;/data/LADEE/ldex_20161118&quot;&lt;/path&gt;
  &lt;/directories&gt;
&lt;/harvest&gt;
</pre></div>



<p>
If you save this file as <i>/tmp/ladee.cfg</i> and run Harvest
</p>
<div class="source"><pre class="prettyprint">
harvest -c /tmp/ladee.cfg
</pre></div>



<p> 
all XML files in <i>/data/LADEE/ldex_20161118</i> folder and its subfolders will be processed.
By default, Harvest extracts only few metadata fields, such as lid, vid, title, and product class.
Extracted metadata is saved in <i>registry-docs.json</i> file. Default output directory is <i>/tmp/harvest/out/</i>.
</p>


<p>
The JSON file has two lines per record / PDS label. The first line contains document ID, for example,
</p>

<div class="source"><pre class="prettyprint">
{&quot;index&quot;:{&quot;_id&quot;:&quot;urn:nasa:pds:ladee_ldex::1.2&quot;}}
</pre></div>

<p>
The second line contains all metadata extracted from a PDS label.
In the example below we split the JSON into multiple lines to make it more readable.
</p>

<div class="source"><pre class="prettyprint">
{
  &quot;lid&quot;: &quot;urn:nasa:pds:ladee_ldex&quot;,
  &quot;vid&quot;: 1.2,
  &quot;lidvid&quot;: &quot;urn:nasa:pds:ladee_ldex::1.2&quot;,
  &quot;title&quot;: &quot;LADEE LUNAR DUST EXPERIMENT&quot;,
  &quot;product_class&quot;: &quot;Product_Bundle&quot;,
  &quot;_package_id&quot;: &quot;9e7c65ec-cc82-4e2f-b2b7-365dc4d028e0&quot;
}
</pre></div>


<p>
The JSON file generated by Harvest can be loaded into Elasticsearch by Registry Manager tool
or by calling Elasticsearch bulk load API.
</p>
</section>




<a name="PackageID"></a><section id="PackageID">
<h2><a name="Package_ID"></a>Package ID</h2>

<p>
Each Harvest run generates unique package ID, stored in <i>_package_id</i> field.
After loading extracted metadata into Elasticsearch, all documents from a particular Harvest run can be 
deleted by this package id.
</p>
</section>



<a name="NodeName"></a><section id="NodeName">
<h2><a name="Node_Name"></a>Node Name</h2>

<p>
Node name is a required parameter which is used to tag ingested data with the node it is ingested by.
</p>


<div class="source"><pre class="prettyprint">
&lt;harvest nodeName=&quot;PDS_SBN&quot;&gt;
...
</pre></div>


<p>
One of the following values can be used:
</p>
<ul>
  
<li><b>PDS_ATM</b>  - Planetary Data System: Atmospheres Node</li>
  
<li><b>PDS_ENG</b>  - Planetary Data System: Engineering Node</li>
  
<li><b>PDS_GEO</b>  - Planetary Data System: Geosciences Node</li>
  
<li><b>PDS_IMG</b>  - Planetary Data System: Imaging Node</li>
  
<li><b>PDS_NAIF</b> - Planetary Data System: NAIF Node</li>
  
<li><b>PDS_RMS</b>  - Planetary Data System: Rings Node</li>
  
<li><b>PDS_SBN</b>  - Planetary Data System: Small Bodies Node at University of Maryland</li>
  
<li><b>PSA</b>      - Planetary Science Archive</li>
  
<li><b>JAXA</b>     - Japan Aerospace Exploration Agency</li>
  
<li><b>ROSCOSMOS</b> - Russian State Corporation for Space Activities</li>
</ul>



<p>
This value is saved in &quot;ops:Harvest_Info/ops:node_name&quot; field:
</p>

<div class="source"><pre class="prettyprint">
{
  &quot;lidvid&quot;: &quot;urn:nasa:pds:ladee_ldex::1.2&quot;,
  &quot;title&quot;: &quot;LADEE LUNAR DUST EXPERIMENT&quot;,
  &quot;ops:Harvest_Info/ops:node_name&quot;: &quot;PDS_SBN&quot;,
...
}
</pre></div>

</section>



<a name="Registry"></a><section id="Registry">
<h2><a name="Registry_Integration"></a>Registry Integration</h2>

<p>
Harvest could query PDS Registry to find out if a product is already registered.
</p>


<p>
To point to a Registry to process only non-registered products, add the following optional configuration section.
</p>


<div class="source"><pre class="prettyprint">
&lt;harvest nodeName=&quot;PDS_SBN&quot;&gt;
  ...
  &lt;registry url=&quot;http://localhost:9200&quot; index=&quot;registry&quot; auth=&quot;/path/to/auth.cfg&quot; /&gt;
  ...
&lt;/harvest&gt;
</pre></div>


<p>&lt;registry&gt; attributes:</p>

<ul>

<li><b>url</b> - Registry (Elasticsearch) URL</li>

<li><b>index</b> - Elasticsearch index name. This is an optional parameter. Default value is 'registry'.</li>

<li><b>auth</b> - Registry (Elasticsearch) authentication configuration file. This is an optional parameter.
The Registry security configuration is described in the <a href="../security/reg-mgr.html">following section</a>.
</li>
</ul>

</section>




<a name="InputDirs"></a><section id="InputDirs">
<h2><a name="Input_Directories_and_Filters"></a>Input Directories and Filters</h2>

<a name="Dirs"></a><section id="Dirs">
<h3><a name="Crawl_Directories"></a>Crawl Directories</h3>

<p>
To process products from one or more directories, add the following section in Harvest configuration file:
</p>

<div class="source"><pre class="prettyprint">
&lt;harvest nodeName=&quot;PDS_SBN&quot;&gt;
  ...
  &lt;directories&gt;
    &lt;path&gt;/some-directory/sub-dir-1/&lt;/path&gt;
    &lt;path&gt;/some-directory/sub-dir-2/&lt;/path&gt;
  &lt;/directories&gt;
  ...
&lt;/harvest&gt;
</pre></div>

<p>
<b>NOTE:</b> You could not have both &lt;directories&gt; and &lt;bundles&gt; sections at the same time.
</p>
</section>


<a name="Bundles"></a><section id="Bundles">
<h3><a name="Crawl_Bundles"></a>Crawl Bundles</h3>

<p>
To process products from one or more bundles, add the following section in Harvest configuration file:
</p>

<div class="source"><pre class="prettyprint">
&lt;harvest nodeName=&quot;PDS_SBN&quot;&gt;
  ...
  &lt;bundles&gt;
    &lt;bundle dir=&quot;/data/geo/urn-nasa-pds-kaguya_grs_spectra&quot; /&gt;
    &lt;bundle dir=&quot;/data/geo/urn-nasa-pds-trang2020_moon_space_weathering&quot; /&gt;
  &lt;/bundles&gt;
  ...
&lt;/harvest&gt;
</pre></div>

<p>
<b>NOTE:</b> You could not have both &lt;directories&gt; and &lt;bundles&gt; sections at the same time.
</p>
</section>



<a name="BundleVersions"></a><section id="BundleVersions">
<h3><a name="Filtering_Bundle_Versions"></a>Filtering Bundle Versions</h3>

<p>
Use &quot;versions&quot; attribute of the &lt;bundle&gt; tag to list versions of bundles to process.
You can separate versions by comma, semicolon or space.
</p>


<div class="source"><pre class="prettyprint">
&lt;harvest nodeName=&quot;PDS_SBN&quot;&gt;
  ...
  &lt;bundles&gt;
    &lt;bundle dir=&quot;/data/OREX/orex_spice&quot; versions=&quot;7.0;8.0&quot; /&gt;
  &lt;/bundles&gt;
  ...
&lt;/harvest&gt;
</pre></div>


<p>
To process all versions you can use either versions=&quot;all&quot; or no versions attribute at all.
</p>


<div class="source"><pre class="prettyprint">
&lt;harvest nodeName=&quot;PDS_SBN&quot;&gt;
  ...
  &lt;bundles&gt;
    &lt;bundle dir=&quot;/data/OREX/orex_spice&quot; versions=&quot;all&quot; /&gt;
  &lt;/bundles&gt;
  ...
&lt;/harvest&gt;
</pre></div>

</section>



<a name="Collections"></a><section id="Collections">
<h3><a name="Filtering_Bundle.27s_Collections"></a>Filtering Bundle's Collections</h3>

<p>
By default Harvest will process all collections listed in &lt;Bundle_Member_Entry&gt;
section of a bundle. To process a subset of collections you can provide a list of
lids or lidvids as shown below.
</p>


<div class="source"><pre class="prettyprint">
&lt;!-- Filter by collection LID --&gt;
&lt;bundle dir=&quot;/data/OREX/orex_spice&quot; versions=&quot;8.0&quot; &gt;
   &lt;collection lid=&quot;urn:nasa:pds:orex.spice:spice_kernels&quot; /&gt;
&lt;/bundle&gt;

&lt;!-- Filter by collection LIDVID --&gt;
&lt;bundle dir=&quot;/data/OREX/orex_spice&quot; versions=&quot;8.0;7.0&quot; &gt;
   &lt;collection lidvid=&quot;urn:nasa:pds:orex.spice:spice_kernels::8.0&quot; /&gt;
   &lt;collection lidvid=&quot;urn:nasa:pds:orex.spice:spice_kernels::7.0&quot; /&gt;
&lt;/bundle&gt;
</pre></div>

</section>



<a name="ProdDirs"></a><section id="ProdDirs">
<h3><a name="Filtering_Bundle.27s_Product_Directories"></a>Filtering Bundle's Product Directories</h3>

<p>
By default Harvest will process all products listed in the collection inventory file.
To process a subset of products you can provide a list of directories.
</p>


<div class="source"><pre class="prettyprint">
&lt;bundle dir=&quot;/data/OREX/orex_spice&quot; versions=&quot;8.0&quot; &gt;
    &lt;!-- Specify a substring in a relative (to the bundle root) directory name.  --&gt;
    &lt;product dir=&quot;/fk/&quot; /&gt;
&lt;/bundle&gt;
</pre></div>

</section>



<a name="ProdClass"></a><section id="ProdClass">
<h3><a name="Filtering_Products_by_Class"></a>Filtering Products by Class</h3>

<p>
You can include or exclude products of a particular class. For example, to only process documents, add following 
product filter in Harvest configuration file:
</p>

<div class="source"><pre class="prettyprint">
&lt;harvest nodeName=&quot;PDS_SBN&quot;&gt;
  ...
  &lt;productFilter&gt;
    &lt;include&gt;Product_Document&lt;/include&gt;
  &lt;/productFilter&gt;
  ...
&lt;/harvest&gt;
</pre></div>

</section>

</section>




<a name="Extract"></a><section id="Extract">
<h2><a name="Extracting_More_Metadata"></a>Extracting More Metadata</h2>

<a name="FileInfo"></a><section id="FileInfo">
<h3><a name="Label_and_Data_File_Information"></a>Label and Data File Information</h3>


<p>
To extracts label and data file information, such as file name, mime type, size, and MD5 hash, 
include the following section in the configuration file.
</p>
<div class="source"><pre class="prettyprint">
&lt;fileInfo /&gt;
</pre></div>



<p>
Now if you run Harvest, both the label file information
</p>

<div class="source"><pre class="prettyprint">
&quot;ops:Label_File_Info/ops:creation_date_time&quot;:&quot;2020-11-18T22:25:05Z&quot;,
&quot;ops:Label_File_Info/ops:file_name&quot;:&quot;naif0012.xml&quot;,
&quot;ops:Label_File_Info/ops:file_ref&quot;:&quot;/C:/tmp/d5/naif0012.xml&quot;,
&quot;ops:Label_File_Info/ops:file_size&quot;:&quot;3398&quot;,
&quot;ops:Label_File_Info/ops:md5_checksum&quot;:&quot;69ea2974a93854d90399b8b8fc3d1334&quot;
</pre></div>


<p>
and data file information
</p>


<div class="source"><pre class="prettyprint">
&quot;ops:Data_File_Info/ops:creation_date_time&quot;:&quot;2020-11-18T22:25:17Z&quot;,
&quot;ops:Data_File_Info/ops:file_name&quot;:&quot;naif0012.tls&quot;,
&quot;ops:Data_File_Info/ops:file_ref&quot;:&quot;/C:/tmp/d5/naif0012.tls&quot;,
&quot;ops:Data_File_Info/ops:file_size&quot;:&quot;5257&quot;,
&quot;ops:Data_File_Info/ops:md5_checksum&quot;:&quot;25a2fff30b0dedb4d76c06727b1895b1&quot;,
&quot;ops:Data_File_Info/ops:mime_type&quot;:&quot;text/plain&quot;,
</pre></div>


<p>
will be extracted.
</p>


<p>
If you don't want to process data files, add the following flag in Harvest configuration file.
</p>


<div class="source"><pre class="prettyprint">
&lt;fileInfo processDataFiles=&quot;false&quot; /&gt;
</pre></div>

</section>



<a name="BLOB"></a><section id="BLOB">
<h3><a name="BLOB_Storage"></a>BLOB Storage</h3>


<p>
You can store whole PDS product labels as BLOBs (Binary Large OBjects). 
To enable this feature, modify <i>fileInfo</i> section in Harvest configuration file.
</p>

<div class="source"><pre class="prettyprint">
&lt;fileInfo storeLabels=&quot;true&quot; /&gt;
</pre></div>


<p>
After running Harvest, <i>es-docs.json</i> file will have <i>&quot;ops/Label_File_Info/ops/blob&quot;</i> field with compressed product label. 
You can expect up to 900% compression rate for some files. 
For example, many LADEE housekeeping labels are about 45KB. Compressed BLOB size is about 5KB.
For smaller files, such as collection labels, compression rate is about 350% (5.5KB file is compressed to 1.6KB).
</p>


<p>
After loading data into Elasticsearch, you can extract BLOBs by running Registry Manager tool:
</p>
<div class="source"><pre class="prettyprint">
registry-manager export-file -lidvid urn:nasa:pds:ladee_ldex:data_calibrated::1.2 -file /tmp/data_calibrated.xml
</pre></div>


</section>




<a name="FileRef"></a><section id="FileRef">
<h3><a name="File_Reference_.2F_Access_URL"></a>File Reference / Access URL</h3>

<p>
Harvest extracts absolute paths of product and label files, such as
</p>


<div class="source"><pre class="prettyprint">
&quot;ops:Label_File_Info/ops:file_ref&quot;:&quot;/tmp/d5/naif0012.xml&quot;,
&quot;ops:Data_File_Info/ops:file_ref&quot;:&quot;/tmp/d5/naif0012.tls&quot;,
</pre></div>


<p>
Note that on Windows, backslashes are replaced with forward slashes and disk letter is included.
</p>


<div class="source"><pre class="prettyprint">
&quot;ops:Label_File_Info/ops:file_ref&quot;:&quot;C:/tmp/d4/bundle_orex_spice_v009.xml&quot;,
</pre></div>



<p>
To replace a file path prefix with another value, such as a URL, add &lt;fileRef/&gt; tag in Harvest configuration file:
</p>
<div class="source"><pre class="prettyprint">
&lt;fileInfo&gt;
  &lt;fileRef replacePrefix=&quot;/C:/tmp/d4/&quot; with=&quot;https://naif.jpl.nasa.gov/pub/naif/pds/pds4/orex/orex_spice/&quot; /&gt;
&lt;/fileInfo&gt;
</pre></div>



<p>
After running Harvest, you should get different <i>file_ref</i> value:
</p>
<div class="source"><pre class="prettyprint">
&quot;ops:Label_File_Info/ops:file_ref&quot;:
    &quot;https://naif.jpl.nasa.gov/pub/naif/pds/pds4/orex/orex_spice/bundle_orex_spice_v009.xml&quot;
</pre></div>


</section>



<a name="XPath"></a><section id="XPath">
<h3><a name="Extract_Metadata_by_XPath"></a>Extract Metadata by XPath</h3>


<p>
To extract metadata by XPath, you have to create one or more mapping files and list them 
in Harvest configuration file as shown below.
</p>
<div class="source"><pre class="prettyprint">
&lt;harvest nodeName=&quot;PDS_SBN&quot;&gt;
...
  &lt;xpathMaps baseDir=&quot;/home/pds/harvest/conf&quot;&gt;
    &lt;xpathMap filePath=&quot;common.xml&quot; /&gt;
    &lt;xpathMap rootElement=&quot;Product_Observational&quot; filePath=&quot;observational.xml&quot; /&gt;
  &lt;/xpathMaps&gt;
&lt;/harvest&gt;
</pre></div>



<p>
In the example above there are two <i>xpathMap</i> entries. Each entry must have <i>filePath</i> attribute 
pointing to a mapping file. A path can be either absolute or relative to the <i>baseDir</i> attribute 
of the <i>xpathMaps</i> tag. The <i>baseDir</i> attribute is optional. The same example with absolute paths
is shown below.
</p>
<div class="source"><pre class="prettyprint">
  &lt;xpathMaps&gt;
    &lt;xpathMap filePath=&quot;/home/pds/harvest/conf/common.xml&quot; /&gt;
    &lt;xpathMap rootElement=&quot;Product_Observational&quot; filePath=&quot;/home/pds/harvest/conf/observational.xml&quot; /&gt;
  &lt;/xpathMaps&gt;
</pre></div>



<p>
An <i>xpathMap</i> entry can have optional <i>rootElement</i> attribute. 
Without this attribute, XPaths queries defined in a mapping file (<i>common.xml</i>),
will run against every XML document processed by Harvest.
With <i>rootElement</i> attribute, only XMLs with that root element will be processed.
</p>

<section>
<h4><a name="Mapping_Files"></a>Mapping Files</h4>


<p>
A mapping file has one or more entries which map an output field name to an XPath query.
For example, to extract <i>start_date_time</i> and <i>stop_date_time</i> from observational products,
you can use the following file.
</p>


<div class="source"><pre class="prettyprint">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;xpaths&gt;
  &lt;xpath fieldName=&quot;start_date_time&quot;&gt;/Product_Observational/Observation_Area/Time_Coordinates/start_date_time&lt;/xpath&gt;
  &lt;xpath fieldName=&quot;stop_date_time&quot;&gt;/Product_Observational/Observation_Area/Time_Coordinates/stop_date_time&lt;/xpath&gt;
&lt;/xpaths&gt;
</pre></div>


<p>
You can use optional <i>dataType=&quot;date&quot;</i> attribute to convert valid PDS dates to 
ISO-8601 &quot;instant&quot; format (e.g., &quot;2013-10-24T00:49:37.457Z&quot;).
</p>


<div class="source"><pre class="prettyprint">
&lt;xpaths&gt;
  &lt;xpath fieldName=&quot;start_date_time&quot; dataType=&quot;date&quot;&gt;/Product_Observational/Observation_Area/Time_Coordinates/start_date_time&lt;/xpath&gt;
  &lt;xpath fieldName=&quot;stop_date_time&quot; dataType=&quot;date&quot;&gt;/Product_Observational/Observation_Area/Time_Coordinates/stop_date_time&lt;/xpath&gt;
&lt;/xpaths&gt;
</pre></div>

</section><section>
<h4><a name="XML_Name_Spaces"></a>XML Name Spaces</h4>

<p>
Harvest ignores namespaces when extracting metadata by XPath.
Below is a fragment of LADEE UVS product label which uses &quot;ladee&quot; namespace for mission area fields.
</p>


<div class="source"><pre class="prettyprint">
  &lt;Observation_Area&gt;
    &lt;Mission_Area&gt;
      &lt;ladee:latitude&gt;17.2367925372247&lt;/ladee:latitude&gt;
      &lt;ladee:longitude&gt;194.054477731391&lt;/ladee:longitude&gt; 
      ...
</pre></div>


<p>
To extract latitude and longitude you can use the following XPaths without namespaces.
</p>


<div class="source"><pre class="prettyprint">
&lt;xpaths&gt;
  &lt;xpath fieldName=&quot;latitude&quot;&gt;//Mission_Area/latitude&lt;/xpath&gt;
  &lt;xpath fieldName=&quot;longitude&quot;&gt;//Mission_Area/longitude&lt;/xpath&gt;
&lt;/xpaths&gt;
</pre></div>

</section></section>



<a name="DDic"></a><section id="DDic">
<h3><a name="Extract_Metadata_by_Data_Dictionary_Class_.2F_Extract_All_Fields"></a>Extract Metadata by Data Dictionary Class / Extract All Fields</h3>


<p>
Harvest can automatically &quot;flatten out&quot; PDS label files and generate field names using the following naming convention:
</p>

<div class="source"><pre class="prettyprint">
&lt;namespace&gt;:&lt;class name&gt;/&lt;namespace&gt;:&lt;attribute name&gt;
</pre></div>


<p>
For example
</p>

<div class="source"><pre class="prettyprint">
&quot;pds:Investigation_Area/pds:name&quot;:&quot;LADEE&quot;,
&quot;pds:Investigation_Area/pds:type&quot;:&quot;Mission&quot;,
&quot;pds:Mission_Area/ladee:activity_number&quot;:&quot;16&quot;,
&quot;pds:Mission_Area/ladee:activity_type&quot;:&quot;Occultation&quot;,
&quot;pds:Mission_Area/ladee:altitude&quot;:&quot;245.731087458064&quot;,
</pre></div>


<p>
To extract all fields, add the following section in Harvest configuration file.
</p>

<div class="source"><pre class="prettyprint">
  &lt;autogenFields /&gt;
</pre></div>


<p>
To extract a subset of fields, add <i>classFilter</i> section which can have a list of 
either include or exclude filters (but not both). The following example will extract all fields from mission area.
</p>

<div class="source"><pre class="prettyprint">
  &lt;autogenFields&gt;
    &lt;classFilter&gt;
      &lt;include&gt;pds:Mission_Area&lt;/include&gt;
    &lt;/classFilter&gt;
  &lt;/autogenFields&gt;
</pre></div>

<section>
<h4><a name="Date_Fields"></a>Date Fields</h4>

<p>
Harvest will try to convert all fields containing &quot;date&quot; string in their names to 
ISO-8601 &quot;instant&quot; format (e.g., &quot;2013-10-24T00:49:37.457Z&quot;).
If a field value could not be converted to ISO-8601 format, a warning message will be printed 
and original value will be saved.
</p>

</section></section>



<a name="IntRefs"></a><section id="IntRefs">
<h3><a name="Internal_References"></a>Internal References</h3>


<p>
Harvest extracts lid and lidvid references from
</p>
<ul>

<li>&lt;Internal_Reference&gt; elements (references are stored in <i>registry-docs.json</i>)</li>

<li>&lt;Bundle_Member_Entry&gt; elements (references are stored in <i>registry-docs.json</i>)</li>

<li>&lt;File_Area_Inventory&gt; inventory files (references are stored in <i>refs-docs.json</i>)</li>
</ul>



<p>
The following naming convention is used for reference fields:
</p>
<div class="source"><pre class="prettyprint">
ref_&lt;lid or lidvid&gt;_&lt;reference type&gt;[_secondary]
</pre></div>



<p>
For example,
</p>
<div class="source"><pre class="prettyprint">
&quot;ref_lid_document&quot;:&quot;urn:nasa:pds:ladee_uvs:document:DPSIS&quot;,
&quot;ref_lid_target&quot;:&quot;urn:nasa:pds:context:target:satellite.moon&quot;,
&quot;ref_lidvid_product&quot;:&quot;urn:nasa:pds:ladee_uvs:raw:0016o_0000::1.0&quot;,
</pre></div>



<p>
By default both primary and secondary references are extracted. To extract only primary references add
following section in Harvest configuration file:
</p>

<div class="source"><pre class="prettyprint">
&lt;harvest nodeName=&quot;PDS_SBN&quot;&gt;
  ...
  &lt;references primaryOnly=&quot;true&quot; /&gt;
  ...
&lt;harvest&gt;
</pre></div>


</section>


</section>




        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      2021..</p>
        </div>
      </div>
    </footer>
  </body>
</html>
